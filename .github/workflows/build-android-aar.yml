- name: Checkout repository
  uses: actions/checkout@v3

- name: Clone AndroidLibXrayLite
  run: git clone https://github.com/2dust/AndroidLibXrayLite.git

- name: Set up Go
  uses: actions/setup-go@v4
  with:
    go-version: "1.21"

- name: Install gomobile
  run: |
    go install golang.org/x/mobile/cmd/gomobile@latest
    gomobile init

- name: Download Android NDK
  uses: android-actions/setup-ndk@v2
  with:
    ndk-version: "25.2.9519653"

- name: Build AAR
  run: |
    cd AndroidLibXrayLite
    go mod tidy
    # optional: generate geoip/geosite assets if required
    # ./scripts/gen_assets.sh
    gomobile bind -v -target=android -androidapi=21 -o ../libv2ray.aar .

- name: Upload AAR Artifact
  uses: actions/upload-artifact@v3
  with:
    name: libv2ray.aar
    path: libv2ray.aar
